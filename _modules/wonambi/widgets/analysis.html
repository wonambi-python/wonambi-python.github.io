<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>wonambi.widgets.analysis &mdash; wonambi 7.11 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/wonambi.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> wonambi
            <img src="../../../_static/wonambi.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                7.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">WONAMBI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#run-it">Run it!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#change-log">Change Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#optional-requirements">Optional Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#status">Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#linux-mac-os-x">Linux / Mac OS X</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#windows">Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../analysis/index.html">Tutorial / Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis/tutorial.html">Get Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis/spectrum.html">Frequency Domain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis/plot3d.html">Plot 3D images</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cmd.html">Command Line</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cmd.html#wonambi">wonambi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cmd.html#won-convert">won_convert</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../gui/index.html">Graphical User Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../gui/open.html">Open Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gui/labels.html">Edit Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gui/channels.html">Plot Channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gui/traces.html">Navigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gui/notes.html">Annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gui/detect.html">Event detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gui/methods.html">Detection methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gui/analysis.html">Analysis console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gui/screenshot.html">Screenshot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/wonambi.html">Modules, classes, functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/wonambi.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/wonambi.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../testing.html">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../testing.html#prepare-test-environment">Prepare Test Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../testing.html#get-files">1. Get Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../testing.html#run-the-tests">2. Run the Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../testing.html#coverage">3. Coverage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../testing.html#documentation">4. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../testing.html#release">5. Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../testing.html#tips-and-tricks">Tips and Tricks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-7">Version 7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-6">Version 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-5">Version 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-4">Version 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-3">Version 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-2">Version 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-1">Version 1</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../todo.html">TODO</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">wonambi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">wonambi.widgets.analysis</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for wonambi.widgets.analysis</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Dialogs for analyses, such as power spectra, PAC, event parameters</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span>

<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">asarray</span><span class="p">,</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">inf</span><span class="p">,</span>
                   <span class="n">logical_and</span><span class="p">,</span> <span class="n">logical_or</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">ravel</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">zeros</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">csv</span> <span class="kn">import</span> <span class="n">writer</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">basename</span><span class="p">,</span> <span class="n">splitext</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> \
        <span class="kn">import</span> <span class="nn">FigureCanvasQTAgg</span> <span class="k">as</span> <span class="nn">FigureCanvas</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> \
        <span class="kn">import</span> <span class="nn">NavigationToolbar2QT</span> <span class="k">as</span> <span class="nn">NavigationToolbar</span>
    <span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">FigureCanvas</span> <span class="o">=</span> <span class="nb">object</span>
    <span class="n">Figure</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tensorpac</span> <span class="kn">import</span> <span class="n">Pac</span>
    <span class="kn">from</span> <span class="nn">tensorpac.pacstr</span> <span class="kn">import</span> <span class="n">pacstr</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">Pac</span> <span class="o">=</span> <span class="n">pacstr</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">fooof</span> <span class="kn">import</span> <span class="n">FOOOF</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">FOOOF</span> <span class="o">=</span> <span class="kc">None</span>

<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QIcon</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QAbstractItemView</span><span class="p">,</span>
                             <span class="n">QButtonGroup</span><span class="p">,</span>
                             <span class="n">QDialog</span><span class="p">,</span>
                             <span class="n">QDialogButtonBox</span><span class="p">,</span>
                             <span class="n">QDoubleSpinBox</span><span class="p">,</span>
                             <span class="n">QErrorMessage</span><span class="p">,</span>
                             <span class="n">QFileDialog</span><span class="p">,</span>
                             <span class="n">QFormLayout</span><span class="p">,</span>
                             <span class="n">QGridLayout</span><span class="p">,</span>
                             <span class="n">QGroupBox</span><span class="p">,</span>
                             <span class="n">QHBoxLayout</span><span class="p">,</span>
                             <span class="n">QLabel</span><span class="p">,</span>
                             <span class="n">QListWidget</span><span class="p">,</span>
                             <span class="n">QMessageBox</span><span class="p">,</span>
                             <span class="n">QProgressDialog</span><span class="p">,</span>
                             <span class="n">QPushButton</span><span class="p">,</span>
                             <span class="n">QSizePolicy</span><span class="p">,</span>
                             <span class="n">QTabWidget</span><span class="p">,</span>
                             <span class="n">QVBoxLayout</span><span class="p">,</span>
                             <span class="n">QWidget</span><span class="p">,</span>
                             <span class="p">)</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">ChanFreq</span><span class="p">,</span> <span class="n">__version__</span>
<span class="kn">from</span> <span class="nn">..trans</span> <span class="kn">import</span> <span class="p">(</span><span class="n">math</span><span class="p">,</span> <span class="n">filter_</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">get_descriptives</span><span class="p">,</span>
                     <span class="n">fetch</span><span class="p">,</span> <span class="n">get_times</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">..trans.analyze</span> <span class="kn">import</span> <span class="p">(</span><span class="n">event_params</span><span class="p">,</span> <span class="n">export_event_params</span><span class="p">,</span>
                             <span class="n">export_freq</span><span class="p">,</span> <span class="n">export_freq_band</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.modal_widgets</span> <span class="kn">import</span> <span class="n">ChannelDialog</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="p">(</span><span class="n">FormStr</span><span class="p">,</span> <span class="n">FormInt</span><span class="p">,</span> <span class="n">FormFloat</span><span class="p">,</span> <span class="n">FormBool</span><span class="p">,</span> <span class="n">FormMenu</span><span class="p">,</span> <span class="n">FormRadio</span><span class="p">,</span>
                    <span class="n">FormSpin</span><span class="p">,</span> <span class="n">freq_from_str</span><span class="p">,</span> <span class="n">short_strings</span><span class="p">,</span> <span class="n">STAGE_NAME</span><span class="p">,</span> <span class="n">ICON</span><span class="p">)</span>

<span class="n">lg</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="AnalysisDialog"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog">[docs]</a><span class="k">class</span> <span class="nc">AnalysisDialog</span><span class="p">(</span><span class="n">ChannelDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dialog for specifying various types of analyses: per event, per epoch or</span>
<span class="sd">    per entire segments of signal. PSD, PAC, event metrics. Option to transform</span>
<span class="sd">    signal before analysis. Creates a pickle object.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    parent : instance of QMainWindow</span>
<span class="sd">        the main window</span>
<span class="sd">    nseg : int</span>
<span class="sd">        number of segments in current selection</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">ChannelDialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Analysis console&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_types</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">one_grp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab_freq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab_pac</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab_evt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_dialog</span><span class="p">()</span>

<div class="viewcode-block" id="AnalysisDialog.create_dialog"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.create_dialog">[docs]</a>    <span class="k">def</span> <span class="nf">create_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the dialog.&quot;&quot;&quot;</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">QDialogButtonBox</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_ok</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_cancel</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ FILE LOCATION ------ &quot;&quot;&quot;</span>

        <span class="n">box_file</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;File location&#39;</span><span class="p">)</span>

        <span class="n">filebutton</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Choose&#39;</span><span class="p">)</span>
        <span class="n">filebutton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_as</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_filename</span> <span class="o">=</span> <span class="n">filebutton</span>

        <span class="n">flayout</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">()</span>
        <span class="n">box_file</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">flayout</span><span class="p">)</span>
        <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Filename&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">idx_filename</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ N_SEG ------ &quot;&quot;&quot;</span>

        <span class="n">box_nseg</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Info&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_nseg</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">(</span><span class="n">box_nseg</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_nseg</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ LOCATION ------ &quot;&quot;&quot;</span>

        <span class="n">box_loc</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">)</span>

        <span class="n">cghl</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">cghl</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Channel group&#39;</span><span class="p">))</span>
        <span class="n">cghl</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_group</span><span class="p">)</span>
        <span class="n">cghl</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">box_loc</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">cghl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Channel(s)&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Cycle(s)&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Stage(s)&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_chan</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_cycle</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_stage</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ CHUNKING ------ &quot;&quot;&quot;</span>

        <span class="n">box_chunk</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Chunking&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;by e&amp;vent&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt_chan_only</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Channel-specific&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;by e&amp;poch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epoch_param</span> <span class="o">=</span> <span class="n">epop</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_to_staging</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Lock to staging epochs&#39;</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;dur_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Duration (sec)&#39;</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;dur&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mf">30.</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;Overlap (0-1)&#39;</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;Step (sec)&#39;</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;step_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mf">30.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;segment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;by longest &amp;run&#39;</span><span class="p">)</span>

        <span class="n">evt_box</span> <span class="o">=</span> <span class="n">QListWidget</span><span class="p">()</span>
        <span class="n">evt_box</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_evt_type</span> <span class="o">=</span> <span class="n">evt_box</span>

        <span class="n">chunk_grp</span> <span class="o">=</span> <span class="n">QButtonGroup</span><span class="p">(</span><span class="n">box_chunk</span><span class="p">)</span>
        <span class="n">chunk_grp</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">])</span>
        <span class="n">chunk_grp</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">])</span>
        <span class="n">chunk_grp</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;segment&#39;</span><span class="p">])</span>

        <span class="n">epoch_grp</span> <span class="o">=</span> <span class="n">QButtonGroup</span><span class="p">(</span><span class="n">box_chunk</span><span class="p">)</span>
        <span class="n">epoch_grp</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">])</span>
        <span class="n">epoch_grp</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">epop</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">])</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">box_chunk</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evt_chan_only</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_evt_type</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_to_staging</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">epop</span><span class="p">[</span><span class="s1">&#39;dur_label&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">epop</span><span class="p">[</span><span class="s1">&#39;dur&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">epop</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">epop</span><span class="p">[</span><span class="s1">&#39;step_val&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;segment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ REJECTION ------ &quot;&quot;&quot;</span>

        <span class="n">box_r</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Rejection&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_dur</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reject_epoch</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Exclude Poor signal epochs&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reject_event</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">([</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;channel-specific&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;from any channel&#39;</span><span class="p">])</span>

        <span class="n">flayout</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">()</span>
        <span class="n">box_r</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">flayout</span><span class="p">)</span>
        <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject_epoch</span><span class="p">)</span>
        <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Exclude Artefact events&#39;</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">reject_event</span><span class="p">)</span>
        <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Minimum duration (sec)&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">min_dur</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ CONCATENATION ------ &quot;&quot;&quot;</span>

        <span class="n">box_c</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Concatenation&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cat</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Concatenate channels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;cycle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Concatenate cycles&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Concatenate between stages&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;discontinuous&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;&#39;</span>
                <span class="s1">&#39;Concatenate discontinuous signal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;evt_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Concatenate between event types&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">box</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">flayout</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">()</span>
        <span class="n">box_c</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">flayout</span><span class="p">)</span>
        <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">])</span>
        <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;cycle&#39;</span><span class="p">])</span>
        <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;evt_type&#39;</span><span class="p">])</span>
        <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;discontinuous&#39;</span><span class="p">])</span>
        <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">])</span>

        <span class="sd">&quot;&quot;&quot; ------ PRE-PROCESSING ------ &quot;&quot;&quot;</span>

        <span class="n">box_pp</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Pre-processing&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Differentiate&#39;</span><span class="p">)</span>

        <span class="n">ftypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="s1">&#39;cheby1&#39;</span><span class="p">,</span> <span class="s1">&#39;cheby2&#39;</span><span class="p">,</span> <span class="s1">&#39;ellip&#39;</span><span class="p">,</span> <span class="s1">&#39;bessel&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;diff&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;bp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tbp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;bandpass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">(</span><span class="n">ftypes</span><span class="p">)</span>
        <span class="n">tbp</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Order&#39;</span><span class="p">),</span> <span class="n">FormSpin</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tbp</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Lowcut (Hz)&#39;</span><span class="p">),</span> <span class="n">FormFloat</span><span class="p">()</span>
        <span class="n">tbp</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Highcut (Hz)&#39;</span><span class="p">),</span> <span class="n">FormFloat</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn1</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;notch1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">(</span><span class="n">ftypes</span><span class="p">)</span>
        <span class="n">tn1</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Order&#39;</span><span class="p">),</span> <span class="n">FormSpin</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tn1</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;CF (Hz)&#39;</span><span class="p">),</span> <span class="n">FormFloat</span><span class="p">()</span>
        <span class="n">tn1</span><span class="p">[</span><span class="s1">&#39;bw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;BW (Hz)&#39;</span><span class="p">),</span> <span class="n">FormFloat</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;n2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;notch2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">(</span><span class="n">ftypes</span><span class="p">)</span>
        <span class="n">tn2</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Order&#39;</span><span class="p">),</span> <span class="n">FormSpin</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tn2</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;CF (Hz)&#39;</span><span class="p">),</span> <span class="n">FormFloat</span><span class="p">()</span>
        <span class="n">tn2</span><span class="p">[</span><span class="s1">&#39;bw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;BW (Hz)&#39;</span><span class="p">),</span> <span class="n">FormFloat</span><span class="p">()</span>

        <span class="n">form1</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">()</span>
        <span class="n">form1</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Bandpass&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;bandpass&#39;</span><span class="p">])</span>
        <span class="n">form1</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">tbp</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
        <span class="n">form1</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">tbp</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">])</span>
        <span class="n">form1</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">tbp</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">])</span>

        <span class="n">form2</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">()</span>
        <span class="n">form2</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Notch 1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;notch1&#39;</span><span class="p">])</span>
        <span class="n">form2</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">tn1</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
        <span class="n">form2</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">tn1</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">])</span>
        <span class="n">form2</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">tn1</span><span class="p">[</span><span class="s1">&#39;bw&#39;</span><span class="p">])</span>

        <span class="n">form3</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">()</span>
        <span class="n">form3</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Notch 2&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;notch2&#39;</span><span class="p">])</span>
        <span class="n">form3</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">tn2</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
        <span class="n">form3</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">tn2</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">])</span>
        <span class="n">form3</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">tn2</span><span class="p">[</span><span class="s1">&#39;bw&#39;</span><span class="p">])</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">box_pp</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">form1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">form2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">form3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ FREQUENCY ------ &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tab_freq</span> <span class="o">=</span> <span class="n">tab_freq</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">freq</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">box_freq_main</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Options&#39;</span><span class="p">)</span>

        <span class="c1">#freq[&#39;freq_on&#39;] = FormBool(&#39;Compute frequency domain&#39;)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_full&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Full spectrum&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Band-limited&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;plot_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Plot mean spectrum&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fooof_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Parametrize&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Pre-process&#39;</span><span class="p">)</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">(</span><span class="n">box_freq_main</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_full&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_band&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;plot_on&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fooof_on&#39;</span><span class="p">])</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_param&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Parameters&#39;</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;scaling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">([</span><span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;fieldtrip&#39;</span><span class="p">,</span> <span class="s1">&#39;chronux&#39;</span><span class="p">])</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;taper&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">([</span><span class="s1">&#39;boxcar&#39;</span><span class="p">,</span> <span class="s1">&#39;hann&#39;</span><span class="p">,</span> <span class="s1">&#39;dpss&#39;</span><span class="p">,</span> <span class="s1">&#39;triang&#39;</span><span class="p">,</span>
            <span class="s1">&#39;blackman&#39;</span><span class="p">,</span> <span class="s1">&#39;hamming&#39;</span><span class="p">,</span> <span class="s1">&#39;bartlett&#39;</span><span class="p">,</span> <span class="s1">&#39;flattop&#39;</span><span class="p">,</span> <span class="s1">&#39;parzen&#39;</span><span class="p">,</span> <span class="s1">&#39;bohman&#39;</span><span class="p">,</span>
                <span class="s1">&#39;blackmanharris&#39;</span><span class="p">,</span> <span class="s1">&#39;nuttall&#39;</span><span class="p">,</span> <span class="s1">&#39;barthann&#39;</span><span class="p">])</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;detrend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">([</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">])</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;welch_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s2">&quot;Time-averaged&quot;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;log_trans&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Log-transform&#39;</span><span class="p">)</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_param&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Scaling&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;scaling&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Taper&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;taper&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Detrend&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;detrend&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;welch_on&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;log_trans&#39;</span><span class="p">])</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_welch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;Time averaging&quot;</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;Overlap (0-1)&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;Step (sec)&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;step_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;centend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">])</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_welch&#39;</span><span class="p">])</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Duration (sec)&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;step_val&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Central tendency&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;centend&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_mtap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Multitaper method (DPSS) smoothing&#39;</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nhbw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Normalized&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;hbw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormSpin</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nhbw_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormSpin</span><span class="p">(</span><span class="n">min_val</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_mtap&#39;</span><span class="p">])</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Half bandwidth (Hz)&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nhbw&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;hbw&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nhbw_val&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Output&#39;</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;spectrald&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;Spectral density&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;Complex&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;sides&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormSpin</span><span class="p">(</span><span class="n">min_val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_output&#39;</span><span class="p">])</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;spectrald&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c1">#grid.addWidget(QLabel(&#39;      &#39;), 2, 0)</span>
        <span class="c1">#grid.addWidget(QLabel(&#39;Side(s)&#39;), 2, 1)</span>
        <span class="c1">#grid.addWidget(freq[&#39;sides&#39;], 2, 2)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_nfft&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;FFT length&#39;</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_seg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;Same as segment&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_fixed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;Fixed:&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_fixed_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormInt</span><span class="p">()</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_zeropad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;Zero-pad to longest segment&#39;</span><span class="p">)</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_nfft&#39;</span><span class="p">])</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_seg&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_fixed&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_fixed_val&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_zeropad&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Normalization&#39;</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">([</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;by integral of each segment&#39;</span><span class="p">,</span>
           <span class="s1">&#39;by mean of event type(s)&#39;</span><span class="p">,</span> <span class="s1">&#39;by mean of stage(s)&#39;</span><span class="p">])</span>
        <span class="n">evt_box</span> <span class="o">=</span> <span class="n">QListWidget</span><span class="p">()</span>
        <span class="n">evt_box</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_evt_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evt_box</span>
        <span class="n">stage_box</span> <span class="o">=</span> <span class="n">QListWidget</span><span class="p">()</span>
        <span class="n">stage_box</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span>
        <span class="n">stage_box</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">STAGE_NAME</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_stage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stage_box</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_concat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Concatenate&#39;</span><span class="p">)</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_norm&#39;</span><span class="p">])</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Event type(s)&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Stage(s)&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_evt_type&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_stage&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_concat&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_cross&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Cross-spectrum&#39;</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;csd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Cross-spectrum&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;gainphase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Gain and phase shift&#39;</span><span class="p">)</span>
        <span class="c1">#freq[&#39;phaseshift&#39;] = FormBool(&#39;Phase shift&#39;)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;coh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Coherence&#39;</span><span class="p">)</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_cross&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;csd&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;gainphase&#39;</span><span class="p">])</span>
        <span class="c1">#form.addRow(freq[&#39;phaseshift&#39;])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;coh&#39;</span><span class="p">])</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_fooof&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Parametrization&#39;</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_min_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_max_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mf">30.</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_pk_thresh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_pk_width_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_pk_width_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mf">12.</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_max_n_pk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormInt</span><span class="p">()</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_min_pk_amp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_bg_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">([</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;knee&#39;</span><span class="p">])</span>

        <span class="n">freqhbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">freqhbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Frequencies:&#39;</span><span class="p">))</span>
        <span class="n">freqhbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_min_freq&#39;</span><span class="p">])</span>
        <span class="n">freqhbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">))</span>
        <span class="n">freqhbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_max_freq&#39;</span><span class="p">])</span>
        <span class="n">freqhbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Hz&#39;</span><span class="p">))</span>

        <span class="n">widhbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">widhbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Peak width:&#39;</span><span class="p">))</span>
        <span class="n">widhbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_pk_width_min&#39;</span><span class="p">])</span>
        <span class="n">widhbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">))</span>
        <span class="n">widhbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_pk_width_max&#39;</span><span class="p">])</span>
        <span class="n">widhbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Hz&#39;</span><span class="p">))</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_fooof&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">freqhbox</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">widhbox</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Peak threshold (SD)&#39;</span><span class="p">,</span>
                    <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_pk_thresh&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Max. number of peaks&#39;</span><span class="p">,</span>
                    <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_max_n_pk&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Min. peak amplitude&#39;</span><span class="p">,</span>
                    <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_min_pk_amp&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Background fitting mode&#39;</span><span class="p">,</span>
                    <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_bg_mode&#39;</span><span class="p">])</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Define bands&#39;</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormStr</span><span class="p">()</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;band_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="n">ICON</span><span class="p">[</span><span class="s1">&#39;help-about&#39;</span><span class="p">]),</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">hlayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">hlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">])</span>
        <span class="n">hlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;band_help&#39;</span><span class="p">])</span>

        <span class="n">vlayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_band&#39;</span><span class="p">])</span>
        <span class="n">vlayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">hlayout</span><span class="p">)</span>

        <span class="n">vlayout1</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_freq_main</span><span class="p">)</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_param&#39;</span><span class="p">])</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_welch&#39;</span><span class="p">])</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_nfft&#39;</span><span class="p">])</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_mtap&#39;</span><span class="p">])</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_output&#39;</span><span class="p">])</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">vlayout2</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">vlayout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_band&#39;</span><span class="p">])</span>
        <span class="n">vlayout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_norm&#39;</span><span class="p">])</span>
        <span class="n">vlayout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_cross&#39;</span><span class="p">])</span>
        <span class="n">vlayout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_fooof&#39;</span><span class="p">])</span>
        <span class="n">vlayout2</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">hlayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">hlayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">vlayout1</span><span class="p">)</span>
        <span class="n">hlayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">vlayout2</span><span class="p">)</span>

        <span class="n">vlayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">tab_freq</span><span class="p">)</span>
        <span class="n">vlayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">hlayout</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ PAC ------ &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Pac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tab_pac</span> <span class="o">=</span> <span class="n">tab_pac</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>

            <span class="n">pac_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">pacstr</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">)]</span>
            <span class="n">pac_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[:</span><span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pac_metrics</span><span class="p">]</span>
            <span class="n">pac_metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Kullback-Leibler Distance&#39;</span> <span class="c1"># corrected typo</span>
            <span class="n">pac_surro</span> <span class="o">=</span> <span class="p">[</span><span class="n">pacstr</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
            <span class="n">pac_norm</span> <span class="o">=</span> <span class="p">[</span><span class="n">pacstr</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pac</span> <span class="o">=</span> <span class="n">pac</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_complex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Complex definition&#39;</span><span class="p">)</span>

            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;Hilbert transform&#39;</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hilb</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;filt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Filter&#39;</span><span class="p">),</span> <span class="n">FormMenu</span><span class="p">([</span><span class="s1">&#39;fir1&#39;</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span>
                <span class="s1">&#39;bessel&#39;</span><span class="p">])</span>
            <span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;cycle_pha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Cycles, phase&#39;</span><span class="p">),</span> <span class="n">FormInt</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;cycle_amp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Cycles, amp&#39;</span><span class="p">),</span> <span class="n">FormInt</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Order&#39;</span><span class="p">),</span> <span class="n">FormInt</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;wavelet_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormRadio</span><span class="p">(</span><span class="s1">&#39;Wavelet convolution&#39;</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;wav_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Width&#39;</span><span class="p">),</span> <span class="n">FormInt</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

            <span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_complex&#39;</span><span class="p">])</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert_on&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;filt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;filt&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;cycle_pha&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;cycle_pha&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;cycle_amp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;cycle_amp&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hilb</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;wavelet_on&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;wav_width&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;wav_width&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_metric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;PAC metric&#39;</span><span class="p">)</span>

            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;pac_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Compute PAC&#39;</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Pre-process&#39;</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">(</span><span class="n">pac_metrics</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;fpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormStr</span><span class="p">()</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;famp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormStr</span><span class="p">()</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;band_help_p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="n">ICON</span><span class="p">[</span><span class="s1">&#39;help-about&#39;</span><span class="p">]),</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
               <span class="bp">self</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;band_help_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="n">ICON</span><span class="p">[</span><span class="s1">&#39;help-about&#39;</span><span class="p">]),</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
               <span class="bp">self</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;nbin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Number of bins&#39;</span><span class="p">),</span> <span class="n">FormInt</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

            <span class="n">hlayoutp</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">hlayoutp</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;fpha&#39;</span><span class="p">])</span>
            <span class="n">hlayoutp</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;band_help_p&#39;</span><span class="p">])</span>

            <span class="n">hlayouta</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">hlayouta</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;famp&#39;</span><span class="p">])</span>
            <span class="n">hlayouta</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;band_help_a&#39;</span><span class="p">])</span>

            <span class="n">flayout</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_metric&#39;</span><span class="p">])</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;pac_on&#39;</span><span class="p">])</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;PAC metric&#39;</span><span class="p">,</span>
                               <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">])</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Phase frequencies (Hz)&#39;</span><span class="p">,</span>
                               <span class="n">hlayoutp</span><span class="p">)</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Amplitude frequencies (Hz)&#39;</span><span class="p">,</span>
                               <span class="n">hlayouta</span><span class="p">)</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;nbin&#39;</span><span class="p">])</span>

            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_surro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Surrogate data&#39;</span><span class="p">)</span>

            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">(</span><span class="n">pac_surro</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">(</span><span class="n">pac_norm</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sur</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">sur</span><span class="p">[</span><span class="s1">&#39;nperm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Number of surrogates&#39;</span><span class="p">),</span> <span class="n">FormInt</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
            <span class="n">sur</span><span class="p">[</span><span class="s1">&#39;nblocks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Number of amplitude blocks&#39;</span><span class="p">),</span>
                              <span class="n">FormInt</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">sur</span><span class="p">[</span><span class="s1">&#39;pval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Get p-values&#39;</span><span class="p">),</span> <span class="kc">None</span>
            <span class="n">sur</span><span class="p">[</span><span class="s1">&#39;save_surro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Save surrogate data&#39;</span><span class="p">),</span> <span class="kc">None</span>

            <span class="n">flayout</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_surro&#39;</span><span class="p">])</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_method&#39;</span><span class="p">])</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_norm&#39;</span><span class="p">])</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">sur</span><span class="p">[</span><span class="s1">&#39;nperm&#39;</span><span class="p">])</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="o">*</span><span class="n">sur</span><span class="p">[</span><span class="s1">&#39;nblocks&#39;</span><span class="p">])</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">sur</span><span class="p">[</span><span class="s1">&#39;pval&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">sur</span><span class="p">[</span><span class="s1">&#39;save_surro&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_opts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Options&#39;</span><span class="p">)</span>

            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;optimize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormMenu</span><span class="p">([</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="s1">&#39;False&#39;</span><span class="p">,</span> <span class="s1">&#39;greedy&#39;</span><span class="p">,</span> <span class="s1">&#39;optimal&#39;</span><span class="p">])</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;njobs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormInt</span><span class="p">(</span><span class="n">default</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">flayout</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_opts&#39;</span><span class="p">])</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Optimize einsum&#39;</span><span class="p">,</span>
                               <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;optimize&#39;</span><span class="p">])</span>
            <span class="n">flayout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Number of jobs&#39;</span><span class="p">,</span>
                               <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;njobs&#39;</span><span class="p">])</span>

            <span class="n">hlayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">hlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;pac_on&#39;</span><span class="p">])</span>
            <span class="n">hlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">])</span>

            <span class="n">vlayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">tab_pac</span><span class="p">)</span>
            <span class="n">vlayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">hlayout</span><span class="p">)</span>
            <span class="c1">#vlayout.addWidget(QLabel(&#39;&#39;))</span>
            <span class="n">vlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_metric&#39;</span><span class="p">])</span>
            <span class="n">vlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_complex&#39;</span><span class="p">])</span>
            <span class="n">vlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_surro&#39;</span><span class="p">])</span>
            <span class="n">vlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_opts&#39;</span><span class="p">])</span>
            <span class="n">vlayout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ EVENTS ------ &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tab_evt</span> <span class="o">=</span> <span class="n">tab_evt</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">ev</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eg</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">eg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
        <span class="n">eg</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Density, per (sec)&#39;</span><span class="p">)</span>
        <span class="n">eg</span><span class="p">[</span><span class="s1">&#39;density_per&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">(</span><span class="mf">30.0</span><span class="p">)</span>
        <span class="n">eg</span><span class="p">[</span><span class="s1">&#39;all_local&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">)</span>
        <span class="n">eg</span><span class="p">[</span><span class="s1">&#39;all_local_prep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">el</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">el</span><span class="p">[</span><span class="s1">&#39;dur&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Duration (sec)&#39;</span><span class="p">),</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">el</span><span class="p">[</span><span class="s1">&#39;minamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Min. amplitude (uV)&#39;</span><span class="p">),</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">el</span><span class="p">[</span><span class="s1">&#39;maxamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Max. amplitude (uV)&#39;</span><span class="p">),</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">el</span><span class="p">[</span><span class="s1">&#39;ptp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Peak-to-peak amplitude (uV)&#39;</span><span class="p">),</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">el</span><span class="p">[</span><span class="s1">&#39;rms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;RMS (uV)&#39;</span><span class="p">),</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">el</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Power (uV^2)&#39;</span><span class="p">),</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">el</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Energy (uV^2s)&#39;</span><span class="p">),</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">el</span><span class="p">[</span><span class="s1">&#39;peakpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Peak power frequency (Hz)&#39;</span><span class="p">),</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">el</span><span class="p">[</span><span class="s1">&#39;peakef&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Peak energy frequency (Hz)&#39;</span><span class="p">),</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">()</span>
        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormFloat</span><span class="p">()</span>

        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;invert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Inverted (down-then-up)&#39;</span><span class="p">)</span>
        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Pre-process&#39;</span><span class="p">)</span>
        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;avg_slope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Average slopes (uV/s)&#39;</span><span class="p">)</span>
        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;max_slope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormBool</span><span class="p">(</span><span class="s1">&#39;Max. slopes (uV/s^2)&#39;</span><span class="p">)</span>

        <span class="n">box_global</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Global&#39;</span><span class="p">)</span>

        <span class="n">grid1</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">box_global</span><span class="p">)</span>
        <span class="n">grid1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">eg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">eg</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">eg</span><span class="p">[</span><span class="s1">&#39;density_per&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">box_local</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Local&#39;</span><span class="p">)</span>

        <span class="n">grid2</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="n">box_local</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Parameter&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Pre-process&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">eg</span><span class="p">[</span><span class="s1">&#39;all_local&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">eg</span><span class="p">[</span><span class="s1">&#39;all_local_prep&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;dur&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;minamp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;minamp&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;maxamp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;maxamp&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;ptp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;ptp&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;rms&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;rms&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;peakpf&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;peakpf&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;peakef&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;peakef&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;band_box&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Band of interest&#39;</span><span class="p">)</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="s1">&#39;band_box&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Lowcut (Hz)&#39;</span><span class="p">,</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Highcut (Hz)&#39;</span><span class="p">,</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">])</span>

        <span class="n">box_sw</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Slow wave&#39;</span><span class="p">)</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">(</span><span class="n">box_sw</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;avg_slope&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;max_slope&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;prep&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;invert&#39;</span><span class="p">])</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_global</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="s1">&#39;band_box&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_local</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_sw</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">vlayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">tab_evt</span><span class="p">)</span>
        <span class="n">vlayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">vlayout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ TRIGGERS ------ &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">button</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_buttons</span><span class="p">)</span>
            <span class="n">button</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">lw</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_chan</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_cycle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_stage</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">idx_evt_type</span><span class="p">]:</span>
            <span class="n">lw</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_concatenate</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()]:</span>
            <span class="n">button</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_buttons</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_concatenate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_concatenate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_group</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_channels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_to_staging</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_buttons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_to_staging</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_concatenate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;discontinuous&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_concatenate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt_chan_only</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span><span class="p">)</span>

        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;dur&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;step_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_buttons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_dur</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reject_epoch</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reject_event</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">box</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;bandpass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_buttons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;notch1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_buttons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;notch2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_buttons</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_full&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_band&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;plot_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fooof_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;taper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;welch_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nhbw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_fixed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_zeropad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;csd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;gainphase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="c1">#freq[&#39;phaseshift&#39;].connect(self.toggle_freq)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;coh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;band_help&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_help</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Pac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;pac_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_pac</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_pac</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;wavelet_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_pac</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_pac</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_method&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_pac</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_pac</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;band_help_p&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_help</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;band_help_a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_help</span><span class="p">,</span> <span class="s1">&#39;amp&#39;</span><span class="p">))</span>

        <span class="n">eg</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_buttons</span><span class="p">)</span>
        <span class="n">eg</span><span class="p">[</span><span class="s1">&#39;all_local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_all_local</span><span class="p">)</span>
        <span class="n">eg</span><span class="p">[</span><span class="s1">&#39;all_local_prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_all_local_prep</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">button</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncheck_all_local</span><span class="p">)</span>
            <span class="n">button</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncheck_all_local</span><span class="p">)</span>
        <span class="c1">#ev[&#39;sw&#39;][&#39;all_slope&#39;].connect(self.check_all_slopes)</span>
        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;avg_slope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_buttons</span><span class="p">)</span>
        <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;max_slope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_buttons</span><span class="p">)</span>

        <span class="n">bbox</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_clicked</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ SET DEFAULTS ------ &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evt_chan_only</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_to_staging</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reject_epoch</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;plot_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_param&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_welch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_nfft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_mtap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_cross&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_fooof&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;welch_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_seg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;spectrald&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;detrend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Pac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert&#39;</span><span class="p">][</span><span class="s1">&#39;filt&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;butter&#39;</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;Kullback-Leibler Distance&#39;</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;optimize&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_complex&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_surro&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_opts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">el</span><span class="p">[</span><span class="s1">&#39;dur&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; ------ LAYOUT MASTER ------ &quot;&quot;&quot;</span>

        <span class="n">box3</span> <span class="o">=</span> <span class="n">QTabWidget</span><span class="p">()</span>

        <span class="n">box3</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tab_freq</span><span class="p">,</span> <span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Pac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">box3</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tab_pac</span><span class="p">,</span> <span class="s1">&#39;PAC&#39;</span><span class="p">)</span>
        <span class="n">box3</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tab_evt</span><span class="p">,</span> <span class="s1">&#39;Events&#39;</span><span class="p">)</span>

        <span class="n">btnlayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">btnlayout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">btnlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>

        <span class="n">hlayout1</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">hlayout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_file</span><span class="p">)</span>
        <span class="n">hlayout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_nseg</span><span class="p">)</span>

        <span class="n">hlayout2</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">hlayout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_r</span><span class="p">)</span>
        <span class="n">hlayout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_c</span><span class="p">)</span>

        <span class="n">vlayout1</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">hlayout1</span><span class="p">)</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_loc</span><span class="p">)</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_chunk</span><span class="p">)</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">hlayout2</span><span class="p">)</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box_pp</span><span class="p">)</span>
        <span class="n">vlayout1</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">vlayout2</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">vlayout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">box3</span><span class="p">)</span>
        <span class="n">vlayout2</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">btnlayout</span><span class="p">)</span>

        <span class="n">mhlayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">mhlayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">vlayout1</span><span class="p">)</span>
        <span class="n">mhlayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">vlayout2</span><span class="p">)</span>
        <span class="n">mhlayout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">mhlayout</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisDialog.update_evt_types"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.update_evt_types">[docs]</a>    <span class="k">def</span> <span class="nf">update_evt_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the event types list when dialog is opened.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">notes</span><span class="o">.</span><span class="n">annot</span><span class="o">.</span><span class="n">event_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_evt_type</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="s1">&#39;norm_evt_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idx_evt_type</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="s1">&#39;norm_evt_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisDialog.toggle_buttons"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.toggle_buttons">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable and disable buttons, according to options selected.&quot;&quot;&quot;</span>
        <span class="n">event_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">epoch_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="c1">#segment_on = self.chunk[&#39;segment&#39;].isChecked()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_to_staging</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">epoch_on</span><span class="p">)</span>
        <span class="n">lock_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_to_staging</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">lock_enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_to_staging</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evt_chan_only</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">event_on</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_evt_type</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">event_on</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reject_epoch</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="ow">not</span> <span class="n">event_on</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reject_event</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">logical_or</span><span class="p">((</span><span class="n">lock_enabled</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lock_on</span><span class="p">),</span>
                                                <span class="ow">not</span> <span class="n">lock_enabled</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;evt_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">event_on</span><span class="p">)</span>

        <span class="n">epop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_param</span>
        <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="n">epop</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">epoch_on</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lock_on</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">epoch_on</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lock_on</span><span class="p">:</span>
            <span class="n">overlap_on</span> <span class="o">=</span> <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">overlap_on</span><span class="p">)</span>
            <span class="n">epop</span><span class="p">[</span><span class="s1">&#39;step_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="ow">not</span> <span class="n">overlap_on</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Pac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">surro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_method&#39;</span><span class="p">]</span>
            <span class="n">surro</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">epoch_on</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">surro</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Swap phase/amplitude across trials&#39;</span><span class="p">:</span>
                <span class="n">surro</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;No surrogates&#39;</span><span class="p">)</span>
        <span class="c1"># &quot;Swap phase/amplitude across trials&quot; only available if using epochs</span>
        <span class="c1"># because trials need to be of equal length</span>

        <span class="k">if</span> <span class="n">event_on</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reject_epoch</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;evt_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;evt_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">epoch_on</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lock_on</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reject_event</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">i</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">i</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;discontinuous&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="ow">not</span> <span class="n">epoch_on</span><span class="p">)</span>

        <span class="n">bandpass_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;bandpass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;bp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">bandpass_on</span><span class="p">)</span>
            <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">bandpass_on</span><span class="p">)</span>

        <span class="n">notch1_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;notch1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">notch1_on</span><span class="p">)</span>
            <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">notch1_on</span><span class="p">)</span>

        <span class="n">notch2_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;notch2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;n2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">notch2_on</span><span class="p">)</span>
            <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">notch2_on</span><span class="p">)</span>

        <span class="n">density_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;density&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;density_per&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">density_on</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">buttons</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">checked</span> <span class="o">=</span> <span class="n">buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="n">buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">checked</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">checked</span><span class="p">:</span>
                <span class="n">buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span>
        <span class="n">ev_psd_on</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                             <span class="n">el</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">el</span><span class="p">[</span><span class="s1">&#39;peakpf&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                             <span class="n">el</span><span class="p">[</span><span class="s1">&#39;peakef&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;band_box&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">ev_psd_on</span><span class="p">)</span>

        <span class="n">sw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span>
        <span class="n">slope_on</span> <span class="o">=</span> <span class="n">sw</span><span class="p">[</span><span class="s1">&#39;avg_slope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="ow">or</span> <span class="n">sw</span><span class="p">[</span><span class="s1">&#39;max_slope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">sw</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">slope_on</span><span class="p">)</span>
        <span class="n">sw</span><span class="p">[</span><span class="s1">&#39;invert&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">slope_on</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnalysisDialog.toggle_concatenate"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.toggle_concatenate">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_concatenate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable and disable concatenation options.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lock_to_staging</span><span class="o">.</span><span class="n">get_value</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_chan</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_cycle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_stage</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">idx_evt_type</span><span class="p">],</span>
                   <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;cycle&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;evt_type&#39;</span><span class="p">]]):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;evt_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;discontinuous&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnalysisDialog.toggle_freq"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.toggle_freq">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable and disable frequency domain options.&quot;&quot;&quot;</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>

        <span class="n">export_full_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_full&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">export_band_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_band&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">freq_on</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">([</span><span class="n">export_full_on</span><span class="p">,</span>
                           <span class="n">export_band_on</span><span class="p">,</span>
                           <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;plot_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span>
                           <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fooof_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_param&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">freq_on</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">freq_on</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_nfft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">freq_on</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_band&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">export_band_on</span><span class="p">)</span>

        <span class="n">welch_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;welch_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="ow">and</span> <span class="n">freq_on</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_welch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">welch_on</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">welch_on</span><span class="p">:</span>
            <span class="n">overlap_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">overlap_on</span><span class="p">)</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;step_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="ow">not</span> <span class="n">overlap_on</span><span class="p">)</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="ow">not</span> <span class="n">welch_on</span><span class="p">)</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_nfft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="ow">not</span> <span class="n">welch_on</span><span class="p">)</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;spectrald&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">nfft_fixed_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_fixed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">zeropad_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_zeropad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_fixed_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">nfft_fixed_on</span><span class="p">)</span>

        <span class="n">epoch_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">rectangular</span> <span class="o">=</span> <span class="n">welch_on</span> <span class="ow">or</span> <span class="n">epoch_on</span> <span class="ow">or</span> <span class="n">zeropad_on</span> <span class="ow">or</span> <span class="n">nfft_fixed_on</span> <span class="ow">or</span> \
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nseg</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">freq_on</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">freq_on</span><span class="p">:</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_full&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">rectangular</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;plot_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">rectangular</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fooof_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">rectangular</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">freq_on</span> <span class="ow">and</span> \
            <span class="p">((</span><span class="n">welch_on</span> <span class="ow">or</span> <span class="n">nfft_fixed_on</span> <span class="ow">or</span> <span class="n">zeropad_on</span><span class="p">)</span> <span class="ow">or</span> \
             <span class="p">(</span><span class="n">export_band_on</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">export_full_on</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;plot_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;plot_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="n">dpss_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;taper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;dpss&#39;</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_mtap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">dpss_on</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dpss_on</span><span class="p">:</span>
            <span class="n">nhbw_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nhbw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nhbw_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">nhbw_on</span><span class="p">)</span>

        <span class="n">complex_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;sides&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">complex_on</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">complex_on</span><span class="p">:</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;welch_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;welch_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;welch_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">norm_evt</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;by mean of event type(s)&#39;</span>
        <span class="n">norm_stage</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;by mean of stage(s)&#39;</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_evt_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">norm_evt</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_stage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">norm_stage</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_concat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">norm_evt</span> <span class="ow">or</span> <span class="n">norm_stage</span><span class="p">)</span>

        <span class="n">nchan</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_chan</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">())</span>
        <span class="c1">#s2 = (self.nseg == 1 and nchan == 2) or (self.nseg == 2 and nchan == 1)</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_cross&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">nchan</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">freq_on</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nchan</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;csd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;gainphase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1">#freq[&#39;phaseshift&#39;].set_value(False)</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;coh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">[</span><span class="n">freq</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csd&#39;</span><span class="p">,</span> <span class="s1">&#39;gainphase&#39;</span><span class="p">,</span> <span class="s1">&#39;coh&#39;</span><span class="p">]]:</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;spectrald&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1">#freq[&#39;norm&#39;].set_value(&#39;none&#39;)</span>
            <span class="c1">#freq[&#39;box_norm&#39;].setEnabled(False)</span>

        <span class="n">fooof_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fooof_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;box_fooof&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">fooof_on</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisDialog.toggle_pac"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.toggle_pac">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_pac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable and disable PAC options.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Pac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pac_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;pac_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">pac_on</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">pac_on</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_complex&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">pac_on</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_surro&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">pac_on</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;box_opts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">pac_on</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">pac_on</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Pac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pac_on</span><span class="p">:</span>

            <span class="n">pac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span>
            <span class="n">hilb_on</span> <span class="o">=</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="n">wav_on</span> <span class="o">=</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;wavelet_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">button</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">hilb_on</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">button</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">button</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">hilb_on</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;wav_width&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">wav_on</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;wav_width&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">wav_on</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s1">&#39;Kullback-Leibler Distance&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Heights ratio&#39;</span><span class="p">]:</span>
                <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;nbin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;nbin&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;nbin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;nbin&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ndPac&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">button</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">button</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">button</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro&#39;</span><span class="p">][</span><span class="s1">&#39;pval&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">ndpac_on</span> <span class="o">=</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ndPac&#39;</span>
            <span class="n">surro_on</span> <span class="o">=</span> <span class="n">logical_and</span><span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_method&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span>
                                       <span class="s1">&#39;No surrogates&#39;</span><span class="p">,</span> <span class="ow">not</span> <span class="n">ndpac_on</span><span class="p">)</span>
            <span class="n">norm_on</span> <span class="o">=</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;No normalization&#39;</span>
            <span class="n">blocks_on</span> <span class="o">=</span> <span class="s1">&#39;across time&#39;</span> <span class="ow">in</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_method&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_method&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="ow">not</span> <span class="n">ndpac_on</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">button</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">surro_on</span> <span class="ow">and</span> <span class="n">norm_on</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">button</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">button</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">surro_on</span> <span class="ow">and</span> <span class="n">norm_on</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro&#39;</span><span class="p">][</span><span class="s1">&#39;nblocks&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">blocks_on</span><span class="p">)</span>
            <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro&#39;</span><span class="p">][</span><span class="s1">&#39;nblocks&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">blocks_on</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ndpac_on</span><span class="p">:</span>
                <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_method&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;No surrogates&#39;</span><span class="p">)</span>
                <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro&#39;</span><span class="p">][</span><span class="s1">&#39;pval&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisDialog.band_help"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.band_help">[docs]</a>    <span class="k">def</span> <span class="nf">band_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Use the following format: [[f1-f2],[f3-f4],[f5-f6]] </span><span class="se">\n\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Band limits follow Python convention: lower-bound inclusive &#39;</span>
                <span class="s1">&#39;and upper-bound exclusive. </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;For example, for delta (0.5-4 Hz), theta (4-8 Hz) and sigma &#39;</span>
                <span class="s1">&#39;(10-16 Hz), write: [[0.5-4],[4-8],[10-16]] </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;In this example, frequencies around 4 Hz belong to the &#39;</span>
                <span class="s1">&#39;theta band.&#39;</span><span class="p">)</span>
        <span class="n">msg3</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;For example, for low gamma (30-60 Hz) and high gamma &#39;</span>
                <span class="s1">&#39;(60-120 Hz), write: [[30-60],[60-120]]&#39;</span><span class="p">)</span>
        <span class="n">msg4</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Alternatively, you may use dynamic notation in this &#39;</span>
                <span class="s1">&#39;format: (start, stop, width, step).</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;For example, to get the range of amplitude bands between &#39;</span>
                <span class="s1">&#39;30 Hz and 130 Hz in non-overlapping 20-Hz bands, write: &#39;</span>
                <span class="s1">&#39;(40,140,20,20).&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;amp&#39;</span> <span class="o">==</span> <span class="n">opt</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg1</span> <span class="o">+</span> <span class="n">msg3</span> <span class="o">+</span> <span class="n">msg4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg1</span> <span class="o">+</span> <span class="n">msg2</span> <span class="o">+</span> <span class="n">msg4</span>

        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">about</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Entering frequency bands&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisDialog.update_nseg"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.update_nseg">[docs]</a>    <span class="k">def</span> <span class="nf">update_nseg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the number of segments, displayed in the dialog.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_grp</span><span class="p">:</span>
            <span class="n">segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_segments</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">segments</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_nseg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Number of segments: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nseg</span><span class="p">))</span>
                <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">segments</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">seg</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">overview</span><span class="o">.</span><span class="n">mark_poi</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_nseg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;No valid segments&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_freq</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnalysisDialog.check_all_local"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.check_all_local">[docs]</a>    <span class="k">def</span> <span class="nf">check_all_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check or uncheck all local event parameters.&quot;&quot;&quot;</span>
        <span class="n">all_local_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;all_local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">buttons</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">all_local_chk</span><span class="p">)</span>
            <span class="n">buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span></div>

<div class="viewcode-block" id="AnalysisDialog.check_all_local_prep"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.check_all_local_prep">[docs]</a>    <span class="k">def</span> <span class="nf">check_all_local_prep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check or uncheck all enabled event pre-processing.&quot;&quot;&quot;</span>
        <span class="n">all_local_pp_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;all_local_prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">buttons</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="n">buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">all_local_pp_chk</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisDialog.uncheck_all_local"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.uncheck_all_local">[docs]</a>    <span class="k">def</span> <span class="nf">uncheck_all_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Uncheck &#39;all local&#39; box when a local event is unchecked.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">buttons</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;all_local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">buttons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;all_local_prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisDialog.button_clicked"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.button_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">button_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Action when button was clicked.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        button : instance of QPushButton</span>
<span class="sd">            which button was pressed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">button</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_ok</span><span class="p">:</span>

            <span class="c1"># File location</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Select location for data export file.&#39;</span>
                <span class="n">error_dialog</span> <span class="o">=</span> <span class="n">QErrorMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;File path error&#39;</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Check for signal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_nseg</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nseg</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;No valid signal found.&#39;</span>
                <span class="n">error_dialog</span> <span class="o">=</span> <span class="n">QErrorMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Error fetching data&#39;</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Which analyses?</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
            <span class="n">freq_full</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_full&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="n">freq_band</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_band&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="n">freq_plot</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;plot_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="n">freq_fooof</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fooof_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="n">freq_prep</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="n">freq_on</span> <span class="o">=</span> <span class="n">freq_full</span> <span class="ow">or</span> <span class="n">freq_band</span> <span class="ow">or</span> <span class="n">freq_plot</span> <span class="ow">or</span> <span class="n">freq_fooof</span>

            <span class="k">if</span> <span class="n">Pac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pac_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;pac_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
                <span class="n">pac_prep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pac_on</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">pac_prep</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">ev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span>
            <span class="n">glob</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
            <span class="n">avg_sl</span> <span class="o">=</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;avg_slope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="n">max_sl</span> <span class="o">=</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;max_slope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="n">loc_prep</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
            <span class="n">slope_prep</span> <span class="o">=</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">freq_on</span> <span class="ow">or</span> <span class="n">pac_on</span> <span class="ow">or</span> <span class="n">glob</span> <span class="ow">or</span> <span class="n">loc</span> <span class="ow">or</span> <span class="n">avg_sl</span> <span class="ow">or</span> <span class="n">max_sl</span><span class="p">):</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;export_band&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">():</span>
                <span class="n">bands</span> <span class="o">=</span> <span class="n">freq_from_str</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Invalid input for Define bands. Click the &#39;</span>
                    <span class="s2">&quot;&#39;i&#39; button for instructions.&quot;</span><span class="p">)</span>
                    <span class="n">error_dialog</span> <span class="o">=</span> <span class="n">QErrorMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">error_dialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Error reading bands&#39;</span><span class="p">)</span>
                    <span class="n">error_dialog</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">return</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;by mean of event type(s)&#39;</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_evt_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Select event type(s) for normalization.&#39;</span>
                <span class="n">error_dialog</span> <span class="o">=</span> <span class="n">QErrorMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Error fetching data&#39;</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;by mean of stage(s)&#39;</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_stage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Select stage(s) for normalization.&#39;</span>
                <span class="n">error_dialog</span> <span class="o">=</span> <span class="n">QErrorMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Error fetching data&#39;</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Fetch signal</span>
            <span class="n">eco</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evt_chan_only</span>
            <span class="n">chan</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="p">(</span><span class="n">eco</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="ow">and</span> <span class="n">eco</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">())</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">chan</span>
            <span class="n">concat_chan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_segments</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">segments</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;No valid signal found.&#39;</span>
                <span class="n">error_dialog</span> <span class="o">=</span> <span class="n">QErrorMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Error fetching data&#39;</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">ding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span>
                               <span class="n">ref_chan</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">one_grp</span><span class="p">[</span><span class="s1">&#39;ref_chan&#39;</span><span class="p">],</span>
                               <span class="n">grp_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">one_grp</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                               <span class="n">concat_chan</span><span class="o">=</span><span class="n">concat_chan</span><span class="p">,</span>
                               <span class="n">max_s_freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;max_s_freq&#39;</span><span class="p">),</span>
                               <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">ding</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;Process interrupted.&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Transform signal</span>
            <span class="k">if</span> <span class="n">freq_prep</span> <span class="ow">or</span> <span class="n">pac_prep</span> <span class="ow">or</span> <span class="n">loc_prep</span> <span class="ow">or</span> <span class="n">slope_prep</span><span class="p">:</span>
                <span class="n">lg</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Pre-processing data&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="sd">&quot;&quot;&quot; ------ FREQUENCY ------ &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">freq_on</span><span class="p">:</span>

                <span class="n">csd_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;csd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
                <span class="n">gainphase_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;gainphase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
                <span class="n">coh_on</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;coh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

                <span class="c1"># don&#39;t need autospectrum if all we want is CSD</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">csd_on</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">gainphase_on</span> <span class="ow">or</span> <span class="n">coh_on</span><span class="p">)):</span>
                    <span class="n">asd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_freq</span><span class="p">()</span> <span class="c1"># autospectral density</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">asd</span><span class="p">:</span>
                        <span class="k">return</span>

                <span class="k">if</span> <span class="n">csd_on</span> <span class="ow">or</span> <span class="n">gainphase_on</span> <span class="ow">or</span> <span class="n">coh_on</span><span class="p">:</span>
                    <span class="n">csd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_freq</span><span class="p">(</span><span class="n">csd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># cross-spectral density</span>
                    <span class="n">chancombo</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">csd</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">freq_out</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">if</span> <span class="n">csd_on</span><span class="p">:</span>
                        <span class="n">freq_out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">csd</span><span class="p">,</span> <span class="s1">&#39;csd&#39;</span><span class="p">,</span>
                                         <span class="p">(</span><span class="s1">&#39;Cross-spectral density, &#39;</span>
                                          <span class="o">+</span> <span class="n">chancombo</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="p">),</span>
                                          <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;semilogy&#39;</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">gainphase_on</span><span class="p">:</span>
                        <span class="n">xg</span><span class="p">,</span> <span class="n">yg</span><span class="p">,</span> <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_freq_cross</span><span class="p">(</span><span class="n">csd</span><span class="p">,</span> <span class="n">asd</span><span class="p">,</span>
                                                            <span class="n">output</span><span class="o">=</span><span class="s1">&#39;gainphase&#39;</span><span class="p">)</span>
                        <span class="n">xchancombo</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">xg</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">ychancombo</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">yg</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">freq_out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">xg</span><span class="p">,</span> <span class="s1">&#39;xgain&#39;</span><span class="p">,</span>
                                         <span class="p">(</span><span class="s1">&#39;Gain, &#39;</span> <span class="o">+</span> <span class="n">xchancombo</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="p">),</span>
                                         <span class="s1">&#39;Gain&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">))</span>
                        <span class="n">freq_out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">yg</span><span class="p">,</span> <span class="s1">&#39;ygain&#39;</span><span class="p">,</span>
                                         <span class="p">(</span><span class="s1">&#39;Gain, &#39;</span> <span class="o">+</span> <span class="n">ychancombo</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="p">),</span>
                                         <span class="s1">&#39;Gain&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">))</span>
                        <span class="n">freq_out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ph</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">,</span>
                                         <span class="p">(</span><span class="s1">&#39;Phase shift, &#39;</span> <span class="o">+</span> <span class="n">xchancombo</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="p">),</span>
                                         <span class="s1">&#39;Phase shift (degrees)&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">coh_on</span><span class="p">:</span>
                        <span class="n">coh</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_freq_cross</span><span class="p">(</span><span class="n">csd</span><span class="p">,</span> <span class="n">asd</span><span class="p">,</span>
                                                       <span class="n">output</span><span class="o">=</span><span class="s1">&#39;coherence&#39;</span><span class="p">)</span>
                        <span class="n">freq_out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coh</span><span class="p">,</span> <span class="s1">&#39;coh&#39;</span><span class="p">,</span>
                                         <span class="p">(</span><span class="s1">&#39;Coherence, &#39;</span> <span class="o">+</span> <span class="n">chancombo</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="p">),</span>
                                         <span class="s1">&#39;Coherence&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">freq_out</span> <span class="o">=</span> <span class="p">[(</span><span class="n">asd</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;semilogy&#39;</span><span class="p">)]</span>

                <span class="k">for</span> <span class="n">one_xf</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">freq_out</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">freq_band</span><span class="p">:</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span>
                                    <span class="s1">&#39;_band.csv&#39;</span><span class="p">)</span>
                        <span class="n">export_freq_band</span><span class="p">(</span><span class="n">one_xf</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">freq_full</span> <span class="ow">or</span> <span class="n">freq_plot</span> <span class="ow">or</span> <span class="n">freq_fooof</span><span class="p">:</span>
                        <span class="n">n_freq_bins</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">one_xf</span><span class="p">]</span>

                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">n_freq_bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_freq_bins</span><span class="p">):</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">one_xf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">one_xf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">desc</span> <span class="o">=</span> <span class="kc">None</span>
                                <span class="n">y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">one_xf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">as_matrix</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span>
                                   <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">one_xf</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]()[</span><span class="mi">0</span><span class="p">]])</span>
                                <span class="n">desc</span> <span class="o">=</span> <span class="n">get_descriptives</span><span class="p">(</span><span class="n">as_matrix</span><span class="p">)</span>
                                <span class="n">y</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>

                            <span class="k">if</span> <span class="n">freq_full</span><span class="p">:</span>
                                <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span>
                                            <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;_full.csv&#39;</span><span class="p">)</span>
                                <span class="n">export_freq</span><span class="p">(</span><span class="n">one_xf</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">freq_plot</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">plot_freq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                                               <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">),</span>
                                               <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">freq_fooof</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">report_fooof</span><span class="p">(</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>

            <span class="sd">&quot;&quot;&quot; ------ PAC ------ &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">pac_on</span><span class="p">:</span>
                <span class="n">pac_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_pac</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">pac_output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">xpac</span><span class="p">,</span> <span class="n">fpha</span><span class="p">,</span> <span class="n">famp</span> <span class="o">=</span> <span class="n">pac_output</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>

                <span class="n">as_matrix</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">ravel</span><span class="p">(</span><span class="n">chan</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">,:,:])</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">xpac</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> \
                         <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chan</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="n">get_descriptives</span><span class="p">(</span><span class="n">as_matrix</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">export_pac</span><span class="p">(</span><span class="n">xpac</span><span class="p">,</span> <span class="n">fpha</span><span class="p">,</span> <span class="n">famp</span><span class="p">,</span> <span class="n">desc</span><span class="p">)</span>

            <span class="sd">&quot;&quot;&quot; ------ EVENTS ------ &quot;&quot;&quot;</span>

            <span class="n">evt_dat</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_evt_params</span><span class="p">()</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">evt_dat</span> <span class="ow">or</span> <span class="n">count</span> <span class="ow">or</span> <span class="n">density</span><span class="p">):</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_params.csv&#39;</span>
                <span class="n">export_event_params</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">evt_dat</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">overview</span><span class="o">.</span><span class="n">mark_poi</span><span class="p">()</span> <span class="c1"># remove poi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">button</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_cancel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">overview</span><span class="o">.</span><span class="n">mark_poi</span><span class="p">()</span> <span class="c1"># remove poi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnalysisDialog.get_segments"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.get_segments">[docs]</a>    <span class="k">def</span> <span class="nf">get_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get segments for analysis. Creates instance of trans.Segments.&quot;&quot;&quot;</span>
        <span class="c1"># Chunking</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">lock_to_staging</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_to_staging</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">epoch_dur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_param</span><span class="p">[</span><span class="s1">&#39;dur&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">epoch_overlap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_param</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">epoch_step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">lock_to_staging</span><span class="p">:</span>
                <span class="n">epoch</span> <span class="o">=</span> <span class="s1">&#39;locked&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">epoch</span> <span class="o">=</span> <span class="s1">&#39;unlocked&#39;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_param</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">epoch_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_param</span><span class="p">[</span><span class="s1">&#39;step_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">epoch_step</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">epoch_step</span> <span class="o">=</span> <span class="mf">0.1</span>

        <span class="c1"># Which channel(s)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_channels</span><span class="p">()</span> <span class="c1"># chan name without group</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">chan</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Which event type(s)</span>
        <span class="n">chan_full</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">evt_type</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evt_chan_only</span><span class="o">.</span><span class="n">get_value</span><span class="p">():</span>
                <span class="n">chan_full</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_group</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
                           <span class="s1">&#39;)&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chan</span><span class="p">]</span>

            <span class="n">evt_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_evt_type</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">evt_type</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">evt_type</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">evt_type</span><span class="p">]</span>

        <span class="c1"># Which cycle(s)</span>
        <span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycles</span><span class="p">()</span>

        <span class="c1"># Which stage(s)</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_stage</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stage</span><span class="p">:</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">x</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_stage</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()]</span>

        <span class="c1"># Concatenation</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;cycle&#39;</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">]),</span>
               <span class="nb">int</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;discontinuous&#39;</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;evt_type&#39;</span><span class="p">]))</span>

        <span class="c1"># Artefact event rejection</span>
        <span class="n">reject_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_event</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">reject_event</span> <span class="o">==</span> <span class="s1">&#39;channel-specific&#39;</span><span class="p">:</span>
            <span class="n">chan_full</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_group</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
                           <span class="s1">&#39;)&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chan</span><span class="p">]</span>
            <span class="n">reject_artf</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">reject_event</span> <span class="o">==</span> <span class="s1">&#39;from any channel&#39;</span><span class="p">:</span>
            <span class="n">reject_artf</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reject_artf</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Other options</span>
        <span class="n">min_dur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_dur</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">reject_epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_epoch</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

        <span class="c1"># Generate title for summary plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_title</span><span class="p">(</span><span class="n">chan_full</span><span class="p">,</span> <span class="n">cycle</span><span class="p">,</span> <span class="n">stage</span><span class="p">,</span> <span class="n">evt_type</span><span class="p">)</span>

        <span class="n">segments</span> <span class="o">=</span> <span class="n">fetch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">notes</span><span class="o">.</span><span class="n">annot</span><span class="p">,</span> <span class="n">cat</span><span class="o">=</span><span class="n">cat</span><span class="p">,</span>
                         <span class="n">evt_type</span><span class="o">=</span><span class="n">evt_type</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="n">stage</span><span class="p">,</span> <span class="n">cycle</span><span class="o">=</span><span class="n">cycle</span><span class="p">,</span>
                         <span class="n">chan_full</span><span class="o">=</span><span class="n">chan_full</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span>
                         <span class="n">epoch_dur</span><span class="o">=</span><span class="n">epoch_dur</span><span class="p">,</span> <span class="n">epoch_overlap</span><span class="o">=</span><span class="n">epoch_overlap</span><span class="p">,</span>
                         <span class="n">epoch_step</span><span class="o">=</span><span class="n">epoch_step</span><span class="p">,</span> <span class="n">reject_epoch</span><span class="o">=</span><span class="n">reject_epoch</span><span class="p">,</span>
                         <span class="n">reject_artf</span><span class="o">=</span><span class="n">reject_artf</span><span class="p">,</span> <span class="n">min_dur</span><span class="o">=</span><span class="n">min_dur</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">segments</span></div>

<div class="viewcode-block" id="AnalysisDialog.transform_data"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.transform_data">[docs]</a>    <span class="k">def</span> <span class="nf">transform_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply pre-processing transformation to data, and add it to data</span>
<span class="sd">        dict.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        data : instance of Segments</span>
<span class="sd">            segments including &#39;data&#39; (ChanTime)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        instance of Segments</span>
<span class="sd">            same object with transformed data as &#39;trans_data&#39; (ChanTime)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span>
        <span class="n">differ</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">bandpass</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;bandpass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">notch1</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;notch1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">notch2</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;notch2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">differ</span><span class="p">:</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">math</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="n">diff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">bandpass</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;bp&#39;</span><span class="p">][</span><span class="s1">&#39;order&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
                <span class="n">f1</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;bp&#39;</span><span class="p">][</span><span class="s1">&#39;f1&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
                <span class="n">f2</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;bp&#39;</span><span class="p">][</span><span class="s1">&#39;f2&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">f1</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">f1</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">f2</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">f2</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">dat</span> <span class="o">=</span> <span class="n">filter_</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">low_cut</span><span class="o">=</span><span class="n">f1</span><span class="p">,</span> <span class="n">high_cut</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
                              <span class="n">ftype</span><span class="o">=</span><span class="n">bandpass</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">notch1</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">][</span><span class="s1">&#39;order&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
                <span class="n">cf</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">][</span><span class="s1">&#39;cf&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
                <span class="n">hbw</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">][</span><span class="s1">&#39;bw&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="n">lo_pass</span> <span class="o">=</span> <span class="n">cf</span> <span class="o">-</span> <span class="n">hbw</span>
                <span class="n">hi_pass</span> <span class="o">=</span> <span class="n">cf</span> <span class="o">+</span> <span class="n">hbw</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">filter_</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">low_cut</span><span class="o">=</span><span class="n">hi_pass</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="n">notch1</span><span class="p">)</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">filter_</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">high_cut</span><span class="o">=</span><span class="n">lo_pass</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="n">notch1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">notch2</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;n2&#39;</span><span class="p">][</span><span class="s1">&#39;order&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
                <span class="n">cf</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;n2&#39;</span><span class="p">][</span><span class="s1">&#39;cf&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
                <span class="n">hbw</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="s1">&#39;n2&#39;</span><span class="p">][</span><span class="s1">&#39;bw&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="n">lo_pass</span> <span class="o">=</span> <span class="n">cf</span> <span class="o">-</span> <span class="n">hbw</span>
                <span class="n">hi_pass</span> <span class="o">=</span> <span class="n">cf</span> <span class="o">+</span> <span class="n">hbw</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">filter_</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">low_cut</span><span class="o">=</span><span class="n">hi_pass</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="n">notch1</span><span class="p">)</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">filter_</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">high_cut</span><span class="o">=</span><span class="n">lo_pass</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="n">notch1</span><span class="p">)</span>

            <span class="n">seg</span><span class="p">[</span><span class="s1">&#39;trans_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dat</span>

        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="AnalysisDialog.save_as"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.save_as">[docs]</a>    <span class="k">def</span> <span class="nf">save_as</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dialog for getting name, location of data export file.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">notes</span><span class="o">.</span><span class="n">annot</span><span class="o">.</span><span class="n">xml_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_data&#39;</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Export analysis data&#39;</span><span class="p">,</span>
                                                  <span class="n">filename</span><span class="p">,</span>
                                                  <span class="s1">&#39;CSV (*.csv)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">short_filename</span> <span class="o">=</span> <span class="n">short_strings</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_filename</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">short_filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisDialog.compute_freq"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.compute_freq">[docs]</a>    <span class="k">def</span> <span class="nf">compute_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csd</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute frequency domain analysis.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of dict</span>
<span class="sd">            each item is a dict where &#39;data&#39; is an instance of ChanFreq for a</span>
<span class="sd">            single segment of signal, &#39;name&#39; is the event type, if applicable,</span>
<span class="sd">            &#39;times&#39; is a tuple of the start and end times in sec, &#39;duration&#39; is</span>
<span class="sd">            the actual duration of the segment, in seconds (can be dissociated</span>
<span class="sd">            from &#39;times&#39; if the signal was concatenated)</span>
<span class="sd">            and with &#39;chan&#39; (str), &#39;stage&#39; (str) and &#39;cycle&#39; (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="n">QProgressDialog</span><span class="p">(</span><span class="s1">&#39;Computing frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;Abort&#39;</span><span class="p">,</span>
                                   <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">setWindowModality</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ApplicationModal</span><span class="p">)</span>

        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
        <span class="n">prep</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">scaling</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;scaling&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">log_trans</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;log_trans&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="c1">#sides = freq[&#39;sides&#39;].get_value()</span>
        <span class="n">taper</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;taper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">halfbandwidth</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;hbw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">NW</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nhbw_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;step_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">centend</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;centend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">detrend</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;detrend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">norm_concat</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_concat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">csd</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;csd&#39;</span>
        <span class="k">elif</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;spectrald&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;spectraldensity&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;complex&#39;</span>

        <span class="n">sides</span> <span class="o">=</span> <span class="s1">&#39;one&#39;</span>
        <span class="c1">#if sides == 1:</span>
        <span class="c1">#    sides = &#39;one&#39;</span>
        <span class="c1">#elif sides == 2:</span>
        <span class="c1">#    sides = &#39;two&#39;</span>

        <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">overlap</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">NW</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nhbw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">():</span>
            <span class="n">NW</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">duration</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;welch_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">():</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">detrend</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">detrend</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_fixed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">n_fft</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_fixed_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_zeropad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">n_fft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">number_of</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
            <span class="n">lg</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;n_fft is zero-padded to: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_fft</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;nfft_seg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">n_fft</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Normalization data preparation</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;by integral of each segment&#39;</span><span class="p">]:</span>
            <span class="n">norm_evt_type</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">norm_stage</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">norm_chan</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ncat</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;by mean of event type(s)&#39;</span><span class="p">:</span>
                <span class="n">norm_chan</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_group</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
                                    <span class="s1">&#39;)&#39;</span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_grp</span><span class="p">[</span><span class="s1">&#39;chan_to_plot&#39;</span><span class="p">]]</span>
                <span class="n">norm_evt_type</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> \
                                 <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_evt_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()]</span>

            <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;by mean of stage(s)&#39;</span><span class="p">:</span>
                <span class="n">norm_stage</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> \
                              <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;norm_stage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()]</span>

            <span class="k">if</span> <span class="n">norm_concat</span><span class="p">:</span>
                <span class="n">ncat</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">lg</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;Getting segments for norm. cat: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ncat</span><span class="p">),</span>
                              <span class="s1">&#39;evt_type&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">norm_evt_type</span><span class="p">),</span> <span class="s1">&#39;stage&#39;</span><span class="p">,</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">norm_stage</span><span class="p">),</span> <span class="s1">&#39;chan&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">norm_chan</span><span class="p">)]))</span>
            <span class="n">norm_seg</span> <span class="o">=</span> <span class="n">fetch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">notes</span><span class="o">.</span><span class="n">annot</span><span class="p">,</span> <span class="n">ncat</span><span class="p">,</span>
                                    <span class="n">evt_type</span><span class="o">=</span><span class="n">norm_evt_type</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="n">norm_stage</span><span class="p">,</span>
                                    <span class="n">chan_full</span><span class="o">=</span><span class="n">norm_chan</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">norm_seg</span><span class="o">.</span><span class="n">segments</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;No valid normalization signal found.&#39;</span>
                <span class="n">error_dialog</span> <span class="o">=</span> <span class="n">QErrorMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Error fetching data&#39;</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">progress</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="n">norm_seg</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chan</span><span class="p">,</span> <span class="n">ref_chan</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">one_grp</span><span class="p">[</span><span class="s1">&#39;ref_chan&#39;</span><span class="p">],</span>
                               <span class="n">grp_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">one_grp</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">prep</span><span class="p">:</span>
                <span class="n">norm_seg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_data</span><span class="p">(</span><span class="n">norm_seg</span><span class="p">)</span>

            <span class="n">all_Sxx</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">norm_seg</span><span class="p">:</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">prep</span><span class="p">:</span>
                    <span class="n">dat</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="s1">&#39;trans_data&#39;</span><span class="p">]</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">Sxx</span> <span class="o">=</span> <span class="n">frequency</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">,</span>
                                <span class="n">sides</span><span class="o">=</span><span class="n">sides</span><span class="p">,</span> <span class="n">taper</span><span class="o">=</span><span class="n">taper</span><span class="p">,</span>
                                <span class="n">halfbandwidth</span><span class="o">=</span><span class="n">halfbandwidth</span><span class="p">,</span> <span class="n">NW</span><span class="o">=</span><span class="n">NW</span><span class="p">,</span>
                                <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
                                <span class="n">detrend</span><span class="o">=</span><span class="n">detrend</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="n">n_fft</span><span class="p">,</span> 
                                <span class="n">log_trans</span><span class="o">=</span><span class="n">log_trans</span><span class="p">,</span> <span class="n">centend</span><span class="o">=</span><span class="n">centend</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Value error encountered in frequency &#39;</span>
                           <span class="s1">&#39;transformation for normalization reference data.&#39;</span>
                           <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">If using time-averaging, make sure the &#39;</span>
                           <span class="s1">&#39;normalization data segments are at least as long &#39;</span>
                           <span class="s1">&#39;as the time window.&#39;</span><span class="p">)</span>
                    <span class="n">error_dialog</span> <span class="o">=</span> <span class="n">QErrorMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">error_dialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Error transforming data&#39;</span><span class="p">)</span>
                    <span class="n">error_dialog</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="n">progress</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
                    <span class="k">return</span>

                <span class="n">all_Sxx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Sxx</span><span class="p">)</span>

            <span class="n">nSxx</span> <span class="o">=</span> <span class="n">ChanFreq</span><span class="p">()</span>
            <span class="n">nSxx</span><span class="o">.</span><span class="n">s_freq</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">.</span><span class="n">s_freq</span>
            <span class="n">nSxx</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
            <span class="n">nSxx</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">]</span>
            <span class="n">nSxx</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
            <span class="n">nSxx</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="n">Sxx</span><span class="o">.</span><span class="n">number_of</span><span class="p">(</span><span class="s1">&#39;chan&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">Sxx</span><span class="o">.</span><span class="n">number_of</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
            <span class="n">nSxx</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span>
                    <span class="n">stack</span><span class="p">([</span><span class="n">x</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_Sxx</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># end of normalization data prep</span>

        <span class="n">lg</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;Freq settings:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">scaling</span><span class="p">,</span> <span class="s1">&#39;sides:&#39;</span><span class="p">,</span>
                         <span class="nb">str</span><span class="p">(</span><span class="n">sides</span><span class="p">),</span> <span class="n">taper</span><span class="p">,</span> <span class="s1">&#39;hbw:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">halfbandwidth</span><span class="p">),</span> <span class="s1">&#39;NW:&#39;</span><span class="p">,</span>
                         <span class="nb">str</span><span class="p">(</span><span class="n">NW</span><span class="p">),</span> <span class="s1">&#39;dur:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">duration</span><span class="p">),</span> <span class="s1">&#39;overlap:&#39;</span><span class="p">,</span>
                         <span class="nb">str</span><span class="p">(</span><span class="n">overlap</span><span class="p">),</span> <span class="s1">&#39;step:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="s1">&#39;detrend:&#39;</span><span class="p">,</span>
                         <span class="nb">str</span><span class="p">(</span><span class="n">detrend</span><span class="p">),</span> <span class="s1">&#39;n_fft:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_fft</span><span class="p">),</span> <span class="s1">&#39;norm&#39;</span><span class="p">,</span>
                         <span class="nb">str</span><span class="p">(</span><span class="n">norm</span><span class="p">),</span> <span class="s1">&#39;log:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">log_trans</span><span class="p">),</span> <span class="s1">&#39;central tendency&#39;</span><span class="p">,</span>
                         <span class="nb">str</span><span class="p">(</span><span class="n">centend</span><span class="p">)]))</span>

        <span class="c1"># Main frequency analysis</span>
        <span class="n">xfreq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">seg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
            <span class="n">new_seg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">prep</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="s1">&#39;trans_data&#39;</span><span class="p">]</span>

            <span class="n">timeline</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_seg</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_seg</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">new_seg</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">timeline</span><span class="p">)</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">s_freq</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">Sxx</span> <span class="o">=</span> <span class="n">frequency</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">,</span>
                                <span class="n">sides</span><span class="o">=</span><span class="n">sides</span><span class="p">,</span> <span class="n">taper</span><span class="o">=</span><span class="n">taper</span><span class="p">,</span>
                                <span class="n">halfbandwidth</span><span class="o">=</span><span class="n">halfbandwidth</span><span class="p">,</span> <span class="n">NW</span><span class="o">=</span><span class="n">NW</span><span class="p">,</span>
                                <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
                                <span class="n">detrend</span><span class="o">=</span><span class="n">detrend</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="n">n_fft</span><span class="p">,</span> 
                                <span class="n">log_trans</span><span class="o">=</span><span class="n">log_trans</span><span class="p">,</span> <span class="n">centend</span><span class="o">=</span><span class="n">centend</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Value error encountered in frequency transformation.&#39;</span>
                <span class="n">error_dialog</span> <span class="o">=</span> <span class="n">QErrorMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Error transforming data&#39;</span><span class="p">)</span>
                <span class="n">error_dialog</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">progress</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">chan</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Sxx</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>

                    <span class="n">dat</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">,:]</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">f_res</span> <span class="o">=</span> <span class="n">sf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">sf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># frequency resolution</span>

                    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;by integral of each segment&#39;</span><span class="p">:</span>
                        <span class="n">norm_dat</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="o">*</span> <span class="n">f_res</span> <span class="c1"># integral by midpoint rule</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">norm_dat</span> <span class="o">=</span> <span class="n">nSxx</span><span class="p">(</span><span class="n">chan</span><span class="o">=</span><span class="n">chan</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">Sxx</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dat</span> <span class="o">/</span> <span class="n">norm_dat</span>

            <span class="n">new_seg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sxx</span>
            <span class="n">xfreq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_seg</span><span class="p">)</span>

            <span class="n">progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">progress</span><span class="o">.</span><span class="n">wasCanceled</span><span class="p">():</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Analysis canceled by user.&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="n">progress</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">xfreq</span></div>

<div class="viewcode-block" id="AnalysisDialog.compute_freq_cross"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.compute_freq_cross">[docs]</a>    <span class="k">def</span> <span class="nf">compute_freq_cross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">asd</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;coherence&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute cross-spectrum, gain, phase shift and/or coherence.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        csd : list of dict with &#39;data&#39; key as instance of ChanFreq</span>
<span class="sd">            cross-spectral density, one channel</span>
<span class="sd">        asd : list of dict with &#39;data&#39; key as instance of ChanFreq</span>
<span class="sd">            autospectral density, two channels</span>
<span class="sd">        output : str</span>
<span class="sd">            &#39;coherence&#39; or &#39;gainphase&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple of list of dict with &#39;data&#39; key as instance of ChanFreq</span>
<span class="sd">            if coherence, tuple contains one dict</span>
<span class="sd">            if gainphase, tuple contains: xgain, ygain, phase</span>
<span class="sd">                where xgain is gain with x as input and y as output</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;coherence&#39;</span><span class="p">:</span>
            <span class="n">coh_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csd</span><span class="p">)):</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">ChanFreq</span><span class="p">()</span>
                <span class="n">dat</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
                <span class="n">dat</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">number_of</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
                <span class="n">dat</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
                <span class="n">dat</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">dat</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">]</span>

                <span class="n">newdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">newdict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dat</span>

                <span class="n">Pxy</span> <span class="o">=</span> <span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Pxx</span> <span class="o">=</span> <span class="n">asd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Pyy</span> <span class="o">=</span> <span class="n">asd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">Cxy</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Pxy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">Pxx</span> <span class="o">/</span> <span class="n">Pyy</span> <span class="c1"># ms coherence</span>

                <span class="n">dat</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Cxy</span>
                <span class="n">coh_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newdict</span><span class="p">)</span>

            <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">coh_list</span><span class="p">,)</span>

        <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;gainphase&#39;</span><span class="p">:</span>
            <span class="n">xg_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">yg_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ph_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csd</span><span class="p">)):</span>
                <span class="n">xgain</span> <span class="o">=</span> <span class="n">ChanFreq</span><span class="p">()</span>
                <span class="n">xgain</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
                <span class="n">xgain</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">number_of</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
                <span class="n">xgain</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
                <span class="n">xgain</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">xgain</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>

                <span class="n">ygain</span> <span class="o">=</span> <span class="n">ChanFreq</span><span class="p">()</span>
                <span class="n">ygain</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
                <span class="n">ygain</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">number_of</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
                <span class="n">ygain</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
                <span class="n">ygain</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ygain</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>

                <span class="n">phase</span> <span class="o">=</span> <span class="n">ChanFreq</span><span class="p">()</span>
                <span class="n">phase</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
                <span class="n">phase</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">number_of</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
                <span class="n">phase</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
                <span class="n">phase</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">phase</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>

                <span class="n">xchan</span> <span class="o">=</span> <span class="n">asd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ychan</span> <span class="o">=</span> <span class="n">asd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">xgain</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">([</span><span class="s1">&#39;--&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">xchan</span><span class="p">,</span> <span class="n">ychan</span><span class="p">))],</span>
                          <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">)</span>
                <span class="n">ygain</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">([</span><span class="s1">&#39;--&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">ychan</span><span class="p">,</span> <span class="n">xchan</span><span class="p">))],</span>
                          <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">)</span>
                <span class="n">phase</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">([</span><span class="s1">&#39;--&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">xchan</span><span class="p">,</span> <span class="n">ychan</span><span class="p">))],</span>
                          <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">)</span>

                <span class="n">Pxy</span> <span class="o">=</span> <span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Pxx</span> <span class="o">=</span> <span class="n">asd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Pyy</span> <span class="o">=</span> <span class="n">asd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">Hx</span> <span class="o">=</span> <span class="n">Pxy</span> <span class="o">/</span> <span class="n">Pxx</span>
                <span class="n">Hy</span> <span class="o">=</span> <span class="n">Pxy</span> <span class="o">/</span> <span class="n">Pyy</span>

                <span class="n">xgain</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Hx</span><span class="p">)</span>
                <span class="n">ygain</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Hy</span><span class="p">)</span>

                <span class="n">phase</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">Hx</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># phase is same in both directions, since Pxx and Pyy are real</span>

                <span class="n">xg_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">xg_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xgain</span>
                <span class="n">xg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xg_dict</span><span class="p">)</span>

                <span class="n">yg_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">yg_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ygain</span>
                <span class="n">yg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yg_dict</span><span class="p">)</span>

                <span class="n">ph_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">csd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">ph_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                <span class="n">ph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ph_dict</span><span class="p">)</span>

            <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">xg_list</span><span class="p">,</span> <span class="n">yg_list</span><span class="p">,</span> <span class="n">ph_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="AnalysisDialog.plot_freq"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.plot_freq">[docs]</a>    <span class="k">def</span> <span class="nf">plot_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;semilogy&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot mean frequency spectrum and display in dialog.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : list</span>
<span class="sd">            vector with frequencies</span>
<span class="sd">        y : ndarray</span>
<span class="sd">            vector with amplitudes</span>
<span class="sd">        title : str</span>
<span class="sd">            plot title</span>
<span class="sd">        ylabel : str</span>
<span class="sd">            plot y label</span>
<span class="sd">        scale : str</span>
<span class="sd">            semilogy, loglog or linear</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
        <span class="n">scaling</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;scaling&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">():</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Amplitude (uV)&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;power&#39;</span> <span class="o">==</span> <span class="n">scaling</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Power spectral density (uV ** 2 / Hz)&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;energy&#39;</span> <span class="o">==</span> <span class="n">scaling</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Energy spectral density (uV ** 2)&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">plot_dialog</span> <span class="o">=</span> <span class="n">PlotDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">plot_dialog</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">show_plot_dialog</span><span class="p">()</span></div>

<div class="viewcode-block" id="AnalysisDialog.report_fooof"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.report_fooof">[docs]</a>    <span class="k">def</span> <span class="nf">report_fooof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create FOOOF (fitting oscillations and 1/f) report.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : ndarray</span>
<span class="sd">            vector with frequencies</span>
<span class="sd">        y : ndarray</span>
<span class="sd">            vector with amplitudes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;_fooof.csv&#39;</span>

        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
        <span class="n">freq_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_min_freq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span>
                      <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_max_freq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()]</span>
        <span class="n">pk_thresh</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_pk_thresh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">pk_width</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_pk_width_min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span>
                    <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_pk_width_max&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()]</span>
        <span class="n">max_n_pk</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_max_n_pk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">min_pk_amp</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_min_pk_amp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">bg_mode</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;fo_bg_mode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">max_n_pk</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_n_pk</span> <span class="o">=</span> <span class="n">inf</span>

        <span class="k">if</span> <span class="n">FOOOF</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lg</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;&quot;fooof&quot; package is required for this function, run &quot;pip install fooof&quot;&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">fm</span> <span class="o">=</span> <span class="n">FOOOF</span><span class="p">(</span><span class="n">peak_width_limits</span><span class="o">=</span><span class="n">pk_width</span><span class="p">,</span> <span class="n">max_n_peaks</span><span class="o">=</span><span class="n">max_n_pk</span><span class="p">,</span>
                   <span class="n">min_peak_height</span><span class="o">=</span><span class="n">min_pk_amp</span><span class="p">,</span> <span class="n">peak_threshold</span><span class="o">=</span><span class="n">pk_thresh</span><span class="p">,</span>
                   <span class="n">aperiodic_mode</span><span class="o">=</span><span class="n">bg_mode</span><span class="p">)</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">freq_range</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lg</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">csv_file</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Wonambi v</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__version__</span><span class="p">)])</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;FOOOF - POWER SPECTRUM MODEL&#39;</span><span class="p">])</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;The model was run on the frequency range &#39;</span>
                              <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1"> Hz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">freq_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                               <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">freq_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])))])</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Frequency Resolution is </span><span class="si">{:1.2f}</span><span class="s1"> Hz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">fm</span><span class="o">.</span><span class="n">freq_res</span><span class="p">)])</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Aperiodic Parameters (offset, &#39;</span> <span class="o">+</span> \
                    <span class="p">(</span><span class="s1">&#39;knee, &#39;</span> <span class="k">if</span> <span class="n">fm</span><span class="o">.</span><span class="n">aperiodic_mode</span> <span class="o">==</span> <span class="s1">&#39;knee&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="s1">&#39;slope): &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:2.4f}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> \
                    <span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">aperiodic_params_</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="o">*</span><span class="n">fm</span><span class="o">.</span><span class="n">aperiodic_params_</span><span class="p">)])</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> peaks were found:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">peak_params_</span><span class="p">))])</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Index&#39;</span><span class="p">,</span> <span class="s1">&#39;CF&#39;</span><span class="p">,</span> <span class="s1">&#39;PW&#39;</span><span class="p">,</span> <span class="s1">&#39;BW&#39;</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">peak_params_</span><span class="p">):</span>
                <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">op</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Goodness of fit metrics:&#39;</span><span class="p">])</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;R^2 of model fit is </span><span class="si">{:5.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">fm</span><span class="o">.</span><span class="n">r_squared_</span><span class="p">)])</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Root mean squared error is </span><span class="si">{:5.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">fm</span><span class="o">.</span><span class="n">error_</span><span class="p">)])</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Haller M, Donoghue T, Peterson E, Varma P, &#39;</span>
                               <span class="s1">&#39;Sebastian P, Gao R, Noto T, Knight RT, &#39;</span>
                               <span class="s1">&#39;Shestyuk A, Voytek B (2018) Parameterizing &#39;</span>
                               <span class="s1">&#39;Neural Power Spectra. bioRxiv, 299859. doi: &#39;</span>
                               <span class="s1">&#39;https://doi.org/10.1101/299859&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="AnalysisDialog.compute_pac"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.compute_pac">[docs]</a>    <span class="k">def</span> <span class="nf">compute_pac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute phase-amplitude coupling values from data.&quot;&quot;&quot;</span>
        <span class="n">n_segments</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="n">QProgressDialog</span><span class="p">(</span><span class="s1">&#39;Computing PAC&#39;</span><span class="p">,</span> <span class="s1">&#39;Abort&#39;</span><span class="p">,</span>
                                   <span class="mi">0</span><span class="p">,</span> <span class="n">n_segments</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">setWindowModality</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ApplicationModal</span><span class="p">)</span>

        <span class="n">pac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span>
        <span class="n">idpac</span> <span class="o">=</span> <span class="p">(</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_method&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span>
                 <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro_norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
        <span class="n">fpha</span> <span class="o">=</span> <span class="n">freq_from_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;fpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
        <span class="n">famp</span> <span class="o">=</span> <span class="n">freq_from_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;famp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
        <span class="n">nbins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;nbin&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">nblocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro&#39;</span><span class="p">][</span><span class="s1">&#39;nblocks&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">dcomplex</span> <span class="o">=</span> <span class="s1">&#39;hilbert&#39;</span>
            <span class="n">filt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert&#39;</span><span class="p">][</span><span class="s1">&#39;filt&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert&#39;</span><span class="p">][</span><span class="s1">&#39;cycle_pha&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert&#39;</span><span class="p">][</span><span class="s1">&#39;cycle_amp&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
            <span class="n">filtorder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;hilbert&#39;</span><span class="p">][</span><span class="s1">&#39;order&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1"># not used</span>
        <span class="k">elif</span> <span class="n">pac</span><span class="p">[</span><span class="s1">&#39;wavelet_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">dcomplex</span> <span class="o">=</span> <span class="s1">&#39;wavelet&#39;</span>
            <span class="n">filt</span> <span class="o">=</span> <span class="s1">&#39;fir1&#39;</span> <span class="c1"># not used</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="c1"># not used</span>
            <span class="n">filtorder</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># not used</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;wav_width&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

        <span class="n">lg</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Instantiating PAC:&#39;</span><span class="p">,</span> <span class="s1">&#39;idpac:&#39;</span><span class="p">,</span>
                          <span class="n">idpac</span><span class="p">,</span> <span class="s1">&#39;fpha:&#39;</span><span class="p">,</span> <span class="n">fpha</span><span class="p">,</span> <span class="s1">&#39;famp:&#39;</span><span class="p">,</span> <span class="n">famp</span><span class="p">,</span>  <span class="s1">&#39;dcomplex:&#39;</span><span class="p">,</span>
                          <span class="n">dcomplex</span><span class="p">,</span> <span class="s1">&#39;filt:&#39;</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="s1">&#39;cycle:&#39;</span><span class="p">,</span> <span class="n">cycle</span><span class="p">,</span>
                          <span class="s1">&#39;filtorder:&#39;</span><span class="p">,</span> <span class="n">filtorder</span><span class="p">,</span> <span class="s1">&#39;width:&#39;</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span>
                          <span class="s1">&#39;nbins:&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="p">,</span> <span class="s1">&#39;nblocks:&#39;</span><span class="p">,</span> <span class="n">nblocks</span><span class="p">]]))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Pac</span><span class="p">(</span><span class="n">idpac</span><span class="o">=</span><span class="n">idpac</span><span class="p">,</span> <span class="n">fpha</span><span class="o">=</span><span class="n">fpha</span><span class="p">,</span> <span class="n">famp</span><span class="o">=</span><span class="n">famp</span><span class="p">,</span> <span class="n">dcomplex</span><span class="o">=</span><span class="n">dcomplex</span><span class="p">,</span>
                <span class="n">filt</span><span class="o">=</span><span class="n">filt</span><span class="p">,</span> <span class="n">cycle</span><span class="o">=</span><span class="n">cycle</span><span class="p">,</span> <span class="n">filtorder</span><span class="o">=</span><span class="n">filtorder</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">nblocks</span><span class="o">=</span><span class="n">nblocks</span><span class="p">)</span>

        <span class="n">nperm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro&#39;</span><span class="p">][</span><span class="s1">&#39;nperm&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">optimize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;optimize&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">get_pval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro&#39;</span><span class="p">][</span><span class="s1">&#39;pval&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">get_surro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;surro&#39;</span><span class="p">][</span><span class="s1">&#39;save_surro&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">njobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;njobs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">optimize</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
            <span class="n">optimize</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">optimize</span> <span class="o">==</span> <span class="s1">&#39;False&#39;</span><span class="p">:</span>
            <span class="n">optimize</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">xpac</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">all_chan</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span>
                <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]))</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">all_chan</span><span class="p">:</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">batch_dat</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">():</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;trans_data&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;chan&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">idpac</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">batch_dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="n">chan</span><span class="o">=</span><span class="n">chan</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">famp</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpha</span><span class="p">)))</span>
            <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;times&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;stage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;cycle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;n_stitch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">get_pval</span><span class="p">:</span>
                <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;pval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">famp</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpha</span><span class="p">)))</span>

            <span class="k">if</span> <span class="n">idpac</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;surro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="n">nperm</span><span class="p">,</span>
                                            <span class="nb">len</span><span class="p">(</span><span class="n">famp</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpha</span><span class="p">)))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">batch</span><span class="p">):</span>
                <span class="n">progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pac</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">():</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;trans_data&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

                <span class="n">sf</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">s_freq</span>

                <span class="k">if</span> <span class="n">idpac</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_batch_dat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">batch_dat</span><span class="p">)</span>
                    <span class="n">new_batch_dat</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">new_batch_dat</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">dat</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">new_batch_dat</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dat</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="n">chan</span><span class="o">=</span><span class="n">chan</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">timeline</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">timeline</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">timeline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">timeline</span><span class="p">)</span> <span class="o">/</span> <span class="n">sf</span>
                <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
                <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;stage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">])</span>
                <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="s1">&#39;cycle&#39;</span><span class="p">])</span>
                <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;n_stitch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="s1">&#39;n_stitch&#39;</span><span class="p">])</span>

                <span class="n">out</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">filterfit</span><span class="p">(</span><span class="n">sf</span><span class="o">=</span><span class="n">sf</span><span class="p">,</span> <span class="n">xpha</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span> <span class="n">xamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">traxis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                  <span class="n">nperm</span><span class="o">=</span><span class="n">nperm</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="n">optimize</span><span class="p">,</span>
                                  <span class="n">get_pval</span><span class="o">=</span><span class="n">get_pval</span><span class="p">,</span> <span class="n">get_surro</span><span class="o">=</span><span class="n">get_surro</span><span class="p">,</span>
                                  <span class="n">njobs</span><span class="o">=</span><span class="n">njobs</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">get_pval</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">get_surro</span><span class="p">:</span>
                        <span class="p">(</span><span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                         <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;pval&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                         <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;surro&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="p">(</span><span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                         <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;pval&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>

                <span class="k">elif</span> <span class="n">get_surro</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                     <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;surro&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span>
                         <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">progress</span><span class="o">.</span><span class="n">wasCanceled</span><span class="p">():</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Analysis canceled by user.&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">return</span>

        <span class="c1">#progress.setValue(counter)</span>

        <span class="k">return</span> <span class="n">xpac</span><span class="p">,</span> <span class="n">fpha</span><span class="p">,</span> <span class="n">famp</span></div>

<div class="viewcode-block" id="AnalysisDialog.export_pac"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.export_pac">[docs]</a>    <span class="k">def</span> <span class="nf">export_pac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xpac</span><span class="p">,</span> <span class="n">fpha</span><span class="p">,</span> <span class="n">famp</span><span class="p">,</span> <span class="n">desc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write PAC analysis data to CSV.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_pac.csv&#39;</span>

        <span class="n">heading_row_1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Segment index&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Start time&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;End time&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Duration&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Stitch&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Stage&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Cycle&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Event type&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Channel&#39;</span><span class="p">,</span>
                       <span class="p">]</span>
        <span class="n">spacer</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">heading_row_1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">heading_row_2</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">fpha</span><span class="p">:</span>
            <span class="n">fp_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">fa</span> <span class="ow">in</span> <span class="n">famp</span><span class="p">:</span>
                <span class="n">fa_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">heading_row_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fp_str</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">fa_str</span> <span class="o">+</span> <span class="s1">&#39;_pac&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;pval&#39;</span> <span class="ow">in</span> <span class="n">xpac</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">xpac</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">heading_row_3</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_pval&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">heading_row_2</span><span class="p">]</span>
            <span class="n">heading_row_2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">heading_row_3</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lg</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">csv_file</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Wonambi v</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__version__</span><span class="p">)])</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">heading_row_1</span> <span class="o">+</span> <span class="n">heading_row_2</span><span class="p">)</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Mean&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">spacer</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]))</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;SD&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">spacer</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s1">&#39;sd&#39;</span><span class="p">]))</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Mean of ln&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">spacer</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s1">&#39;mean_log&#39;</span><span class="p">]))</span>
            <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;SD of ln&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">spacer</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s1">&#39;sd_log&#39;</span><span class="p">]))</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">xpac</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;times&#39;</span><span class="p">]):</span>
                    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="n">cyc</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;cycle&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">cyc</span> <span class="o">=</span> <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;cycle&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

                    <span class="n">data_row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ravel</span><span class="p">(</span><span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]))</span>

                    <span class="n">pval_row</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="s1">&#39;pval&#39;</span> <span class="ow">in</span> <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">]:</span>
                        <span class="n">pval_row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ravel</span><span class="p">(</span><span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;pval&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]))</span>

                    <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">idx</span><span class="p">,</span>
                                       <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;duration&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                       <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;n_stitch&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                       <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;stage&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                       <span class="n">cyc</span><span class="p">,</span>
                                       <span class="n">xpac</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                       <span class="n">chan</span><span class="p">,</span>
                                       <span class="p">]</span> <span class="o">+</span> <span class="n">data_row</span> <span class="o">+</span> <span class="n">pval_row</span><span class="p">)</span></div>

<div class="viewcode-block" id="AnalysisDialog.compute_evt_params"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.compute_evt_params">[docs]</a>    <span class="k">def</span> <span class="nf">compute_evt_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute event parameters.&quot;&quot;&quot;</span>
        <span class="n">ev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span>
        <span class="n">glob</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">prep</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">slopes</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">f2</span><span class="p">:</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">band</span> <span class="o">=</span> <span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">slopes</span><span class="p">[</span><span class="s1">&#39;avg_slope&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">slopes</span><span class="p">[</span><span class="s1">&#39;max_slope&#39;</span><span class="p">]):</span>
            <span class="n">slopes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">evt_dat</span> <span class="o">=</span> <span class="n">event_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">band</span><span class="p">,</span> <span class="n">slopes</span><span class="o">=</span><span class="n">slopes</span><span class="p">,</span>
                               <span class="n">prep</span><span class="o">=</span><span class="n">prep</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">density</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">glob</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]:</span>
            <span class="n">epoch_dur</span> <span class="o">=</span> <span class="n">glob</span><span class="p">[</span><span class="s1">&#39;density_per&#39;</span><span class="p">]</span>
            <span class="c1"># get period of interest based on stage and cycle selection</span>
            <span class="n">poi</span> <span class="o">=</span> <span class="n">get_times</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">notes</span><span class="o">.</span><span class="n">annot</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">,</span>
                            <span class="n">cycle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">total_dur</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">poi</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">]])</span>
            <span class="n">density</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">total_dur</span> <span class="o">/</span> <span class="n">epoch_dur</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">evt_dat</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span></div>

<div class="viewcode-block" id="AnalysisDialog.make_title"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.AnalysisDialog.make_title">[docs]</a>    <span class="k">def</span> <span class="nf">make_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span> <span class="n">cycle</span><span class="p">,</span> <span class="n">stage</span><span class="p">,</span> <span class="n">evt_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a title for plots, etc.&quot;&quot;&quot;</span>
        <span class="n">cyc_str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cyc_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">]</span>
            <span class="n">cyc_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;cycle &#39;</span> <span class="o">+</span> <span class="n">cyc_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">title</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">])</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="n">chan</span><span class="p">,</span> <span class="n">cyc_str</span><span class="p">,</span>
                 <span class="n">stage</span><span class="p">,</span> <span class="n">evt_type</span><span class="p">]</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

        <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">title</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PlotCanvas"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.PlotCanvas">[docs]</a><span class="k">class</span> <span class="nc">PlotCanvas</span><span class="p">(</span><span class="n">FigureCanvas</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Widget for showing plots.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

        <span class="n">FigureCanvas</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="n">FigureCanvas</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span>
                <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="n">FigureCanvas</span><span class="o">.</span><span class="n">updateGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="PlotCanvas.plot"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.PlotCanvas.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;semilogy&#39;</span><span class="p">,</span> <span class="n">idx_lim</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Plot the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : ndarray</span>
<span class="sd">            vector with frequencies</span>
<span class="sd">        y : ndarray</span>
<span class="sd">            vector with amplitudes</span>
<span class="sd">        title : str</span>
<span class="sd">            title of the plot, to appear above it</span>
<span class="sd">        ylabel : str</span>
<span class="sd">            label for the y-axis</span>
<span class="sd">        scale : str</span>
<span class="sd">            &#39;log y-axis&#39;, &#39;log both axes&#39; or &#39;linear&#39;, to set axis scaling</span>
<span class="sd">        idx_lim : tuple of (int or None)</span>
<span class="sd">            indices of the data to plot. by default, the first value is left</span>
<span class="sd">            out, because of assymptotic tendencies near 0 Hz.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">idx_lim</span><span class="p">)]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">idx_lim</span><span class="p">)]</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;semilogy&#39;</span> <span class="o">==</span> <span class="n">scale</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;loglog&#39;</span> <span class="o">==</span> <span class="n">scale</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;linear&#39;</span> <span class="o">==</span> <span class="n">scale</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PlotDialog"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.PlotDialog">[docs]</a><span class="k">class</span> <span class="nc">PlotDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dialog for displaying plots.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowModality</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ApplicationModal</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">PlotCanvas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_dialog</span><span class="p">()</span>

<div class="viewcode-block" id="PlotDialog.create_dialog"><a class="viewcode-back" href="../../../api/wonambi.widgets.analysis.html#wonambi.widgets.analysis.PlotDialog.create_dialog">[docs]</a>    <span class="k">def</span> <span class="nf">create_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the basic dialog.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="n">QDialogButtonBox</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_close</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_close</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>

        <span class="n">btnlayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">btnlayout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">btnlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">btnlayout</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2022, Gio Piantoni / Jordan O&#39;Byrne.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>